# =================================================================
# NOVIS LEGAL SYSTEM - APPLICATION CONFIGURATION
# =================================================================

# =================================================================
# DATABASE CONFIGURATION (Azure SQL)
# =================================================================
spring.datasource.url=jdbc:sqlserver://server-novis.database.windows.net:1433;database=novisdb;encrypt=true;trustServerCertificate=false;hostNameInCertificate=*.database.windows.net;loginTimeout=30;
spring.datasource.username=novisadmin
spring.datasource.password=${DB_PASSWORD:[4E(<4q:n0oF}
spring.datasource.driver-class-name=com.microsoft.sqlserver.jdbc.SQLServerDriver

# Connection Pool Settings
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.connection-timeout=20000

# =================================================================
# JPA / HIBERNATE CONFIGURATION
# =================================================================
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.SQLServerDialect
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# =================================================================
# SERVER CONFIGURATIONnone
# =================================================================
server.port=8080
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration
server.error.include-message=always
server.error.include-binding-errors=always

# =================================================================
# LOGGING CONFIGURATION
# =================================================================
logging.level.com.example.novisapp=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.pattern.console=%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n
logging.file.name=logs/novis-legal-system.log

# =================================================================
# SPRING SECURITY CONFIGURATION
# =================================================================
spring.security.user.name=admin
spring.security.user.password=admin123
spring.security.user.roles=ADMIN

# JWT Configuration
jwt.secret=${JWT_SECRET:novis-legal-system-secret-key-2025-extended-for-hs512-algorithm-security-requirements-minimum-512-bits-needed}
jwt.expiration=86400000

# =================================================================
# FILE UPLOAD CONFIGURATION
# =================================================================
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=200MB
spring.servlet.multipart.file-size-threshold=2KB
spring.servlet.multipart.location=${java.io.tmpdir}
# =================================================================
# AZURE STORAGE CONFIGURATION (para documentos)
# =================================================================
azure.storage.connection-string=${AZURE_STORAGE_CONNECTION_STRING:DefaultEndpointsProtocol=https;AccountName=novisalmacenamiento;AccountKey=8/AW0qGRHm7gZn3J8BQ3jXxNhpB3gKW/kUsGIYLT1FAKJM9SMNTczrQc9fAFIvjRRvrAzpKr6b1/+ASt23IFzQ==;EndpointSuffix=core.windows.net}
azure.storage.container.documents=novis-documents
azure.storage.container.images=novis-images
azure.storage.container.temp=novis-temp

# =================================================================
# EMAIL CONFIGURATION (Azure Communication Services)
# =================================================================
azure.communication.connection-string=${AZURE_COMM_CONNECTION:endpoint=https://novis-comm.communication.azure.com/;accesskey=your-key}
email.from-address=noreply@novis.legal
email.from-name=Sistema Legal Novis

# =================================================================
# SCHEDULED TASKS CONFIGURATION
# =================================================================
# Cobranza automática (miércoles)
schedule.cobranza.cron=0 0 9 * * WED
# Reportes de comisiones (días 13 y 28)
schedule.comisiones.cron=0 0 8 13,28 * *
# Verificación post-entrega (día 8)
schedule.seguimiento.cron=0 0 10 * * *

# =================================================================
# BUSINESS RULES CONFIGURATION
# =================================================================
# Facturación solo lunes
business.facturacion.solo-lunes=true
# Días para cobranza automática
business.cobranza.dias-mora=40
business.cobranza.segunda-gestion=50
business.cobranza.tercera-gestion=60
# Días para seguimiento post-entrega
business.seguimiento.dias-espera=8
# Límite de archivos por caso
business.documentos.max-archivos-por-caso=200

# =================================================================
# PAGINATION CONFIGURATION
# =================================================================
spring.data.web.pageable.default-page-size=20
spring.data.web.pageable.max-page-size=100

# =================================================================
# DEVELOPMENT/PRODUCTION PROFILES
# =================================================================
spring.profiles.active=${SPRING_PROFILES_ACTIVE:dev}

# =================================================================
# ACTUATOR (Monitoring y Health Checks)

management.endpoints.web.exposure.include=health,info,metrics,prometheus,financial
management.endpoint.health.show-details=when-authorized
management.info.env.enabled=true

# =================================================================
# CUSTOM APPLICATION PROPERTIES
# =================================================================
app.name=Novis Legal System
app.version=1.0.0
app.description=Sistema de Gestión Legal Integral
app.contact.email=admin@novis.legal
app.timezone=America/Mexico_City

# =================================================================
# GESTIÓN DOCUMENTAL AVANZADA - DÍA 4
# =================================================================

# Configuraciones específicas de documentos Novis
novis.documents.max-file-size=52428800
novis.documents.max-files-per-case=200
novis.documents.allowed-types=PDF,DOCX,XLSX,TXT,JPG,JPEG,PNG,GIF,DOC,XLS,PPTX,MP3,MP4,WAV,MOV,AVI
novis.documents.scan-for-viruses=false
novis.documents.auto-backup=true
novis.documents.retention-days=2555
novis.documents.enable-versioning=true
novis.documents.compress-images=true
novis.documents.generate-thumbnails=false

# Auditoría de documentos
novis.audit.enable-document-tracking=true
novis.audit.log-access-events=true
novis.audit.track-ip-addresses=true

# Seguridad documental
novis.security.encrypt-sensitive-docs=false
novis.security.require-approval-for-deletion=false
novis.security.enable-watermarks=false

# Configuraciones de equipos (Del Día 3)
novis.teams.min-lawyers-per-case=2
novis.teams.max-cases-per-lawyer=10
novis.teams.auto-assignment=true
novis.teams.workload-balancing=true

# Logging adicional para documentos
logging.level.com.example.novisapp.service.DocumentService=DEBUG
logging.level.com.azure.storage=WARN
logging.level.org.springframework.web.multipart=DEBUG

# Configuraciones adicionales Jackson
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=America/El_Salvador

# =================================================================
# CONFIGURACIÓN JACKSON PARA EVITAR RECURSIÓN - AGREGAR AL FINAL
# =================================================================

# Configuración Jackson para evitar recursión infinita
spring.jackson.serialization.fail-on-empty-beans=false

spring.jackson.serialization.indent-output=true
spring.jackson.default-property-inclusion=NON_NULL

# Configuraciones adicionales Jackson (para mejorar la serialización)
spring.jackson.serialization.write-null-map-values=false
spring.jackson.serialization.write-empty-json-arrays=true
spring.jackson.deserialization.fail-on-unknown-properties=false
spring.jackson.mapper.accept-case-insensitive-enums=true

# Configuración específica para relaciones JPA
spring.jpa.properties.hibernate.enable_lazy_load_no_trans=true

# =================================================================
# CONFIGURACIÓN MÓDULO FINANCIERO - DÍA 11
# =================================================================

# Configuraciones financieras
novis.financial.default-hourly-rate=150.00
novis.financial.default-currency=USD
novis.financial.tax-rate=0.15
novis.financial.auto-invoice-enabled=false

# Configuraciones de facturación
novis.billing.net-payment-days=30
novis.billing.overdue-days=45
novis.billing.auto-reminder-days=25

# Configuraciones de tiempo
novis.time-tracking.minimum-entry-minutes=6
novis.time-tracking.maximum-daily-hours=16

# Configuraciones de gastos
novis.expenses.auto-approval-limit=100.00
novis.expenses.require-receipt-above=50.00

# Logging adicional para módulo financiero
logging.level.com.example.novisapp.service.FinancialService=DEBUG
logging.level.com.example.novisapp.controller.FinancialController=DEBUG
logging.level.com.example.novisapp.controller.TimeTrackingController=DEBUG

# =================================================================
# CONFIGURACIONES ADICIONALES PARA MÓDULO FINANCIERO - SIN DUPLICADOS
# =================================================================

# ====== CONFIGURACIONES SWAGGER/OPENAPI (NUEVAS) ======
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.operationsSorter=alpha
springdoc.swagger-ui.tagsSorter=alpha
springdoc.swagger-ui.tryItOutEnabled=true

# ====== CONFIGURACIONES FINANCIERAS AVANZADAS (NUEVAS) ======

# Configuración de cronómetro
app.financial.time-tracking.auto-close-abandoned-hours=24
app.financial.time-tracking.session-cleanup-cron=0 0 2 * * ?

# Configuración de aprobaciones
app.financial.approvals.time-entry-approval-required=true
app.financial.approvals.expense-approval-required=true

# Configuración de notificaciones
app.financial.notifications.pending-approval-reminder-hours=24
app.financial.notifications.overdue-invoice-reminder-days=3
app.financial.notifications.email-enabled=true

# Configuración de reportes
app.financial.reports.cache-duration-minutes=15
app.financial.reports.default-period-months=3
app.financial.reports.max-export-records=10000

# Configuración de dashboard
app.financial.dashboard.refresh-interval-seconds=30
app.financial.dashboard.real-time-enabled=true
app.financial.dashboard.kpi-cache-minutes=10

# Configuración de facturación automática
app.financial.billing.auto-convert-sessions=false
app.financial.billing.require-description=true
app.financial.billing.round-to-nearest-minutes=6

# Configuración de seguridad financiera
app.financial.security.audit-all-changes=true
app.financial.security.encrypt-sensitive-data=false

# ====== CONFIGURACIONES DE CACHÉ (NUEVAS) ======
spring.cache.type=caffeine
spring.cache.caffeine.spec=maximumSize=1000,expireAfterWrite=15m
spring.cache.cache-names=financial-dashboard,revenue-reports,time-analytics,user-stats

# ====== CONFIGURACIONES DE BACKUP FINANCIERO (NUEVAS) ======
app.financial.backup.enabled=true
app.financial.backup.schedule=0 0 3 * * ?
app.financial.backup.retention-days=90
app.financial.backup.include-time-data=true

# ====== CONFIGURACIONES DE THREAD POOL (NUEVAS) ======
spring.task.execution.pool.core-size=5
spring.task.execution.pool.max-size=20
spring.task.execution.pool.queue-capacity=100
spring.task.execution.thread-name-prefix=novis-financial-

# ====== CONFIGURACIONES DE CORS PARA FRONTEND (NUEVAS) ======
app.cors.allowed-origins=http://localhost:3000,http://localhost:8080,https://novis-frontend.azurewebsites.net
app.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
app.cors.allowed-headers=*
app.cors.allow-credentials=true

# ====== CONFIGURACIONES ADICIONALES DE MONITOREO ======
management.metrics.tags.application=novis-financial
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.health.custom.enabled=true



# Logs adicionales para debugging
logging.level.com.example.novisapp.controller.DocumentController=DEBUG

logging.level.org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter=DEBUG

# Para ver requests HTTP completos
logging.level.org.springframework.web.servlet.DispatcherServlet=DEBUG